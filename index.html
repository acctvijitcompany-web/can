<!doctype html>
<html lang="th">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô</title>

    <!-- TailwindCSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- QR Code -->
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>

    <!-- Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    >

    <style>
      body {
        box-sizing: border-box;
        font-family: 'Noto Sans Thai', sans-serif;
      }

      html, body {
        height: 100%;
      }

      h1, h2, h3, h4, h5, h6, p, span, div, button, input, textarea, select, label {
        font-family: 'Noto Sans Thai', sans-serif;
      }

      * {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .glass-effect {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
      }

      .stat-card {
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
      }

      .stat-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
        transition: left 0.5s;
      }

      .stat-card:hover::before {
        left: 100%;
      }

      .stat-card:hover {
        transform: translateY(-8px) scale(1.02);
        box-shadow: 0 20px 40px rgba(0,0,0,0.2);
      }

      .task-item {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        border-left: 4px solid transparent;
      }

      .task-item:hover {
        background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
        border-left-color: #667eea;
        transform: translateX(8px);
        box-shadow: 0 8px 24px rgba(102, 126, 234, 0.15);
      }

      .star {
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        filter: grayscale(100%);
        opacity: 0.5;
      }

      .star:hover {
        transform: scale(1.3) rotate(10deg);
        filter: grayscale(0%);
        opacity: 1;
      }

      .star.active {
        color: #fbbf24;
        filter: grayscale(0%) drop-shadow(0 0 8px rgba(251, 191, 36, 0.6));
        opacity: 1;
        animation: starPulse 0.5s ease-out;
      }

      @keyframes starPulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.3); }
      }

      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .fade-in-up {
        animation: fadeInUp 0.6s ease-out forwards;
      }

      .timeline-item {
        position: relative;
        padding-left: 50px;
        padding-bottom: 40px;
        opacity: 0;
        animation: fadeInUp 0.6s ease-out forwards;
      }

      .timeline-item::before {
        content: '';
        position: absolute;
        left: 19px;
        top: 40px;
        bottom: -10px;
        width: 3px;
        background: linear-gradient(180deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
        box-shadow: 0 0 10px rgba(102, 126, 234, 0.5);
      }

      .timeline-item:last-child::before {
        display: none;
      }

      .timeline-dot {
        position: absolute;
        left: 10px;
        top: 10px;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border: 4px solid white;
        box-shadow: 0 0 0 3px #667eea, 0 4px 12px rgba(102, 126, 234, 0.4);
        z-index: 1;
        animation: pulse 2s infinite;
      }

      @keyframes pulse {
        0%, 100% {
          box-shadow: 0 0 0 3px #667eea, 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        50% {
          box-shadow: 0 0 0 6px rgba(102, 126, 234, 0.3), 0 4px 12px rgba(102, 126, 234, 0.6);
        }
      }

      .timeline-content {
        background: white;
        border-radius: 16px;
        padding: 20px;
        box-shadow: 0 4px 16px rgba(0,0,0,0.08);
        border: 1px solid rgba(102, 126, 234, 0.1);
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .timeline-content:hover {
        box-shadow: 0 12px 32px rgba(102, 126, 234, 0.2);
        transform: translateX(8px) translateY(-4px);
        border-color: rgba(102, 126, 234, 0.3);
      }

      .time-badge {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 6px 14px;
        background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
        border-radius: 24px;
        font-size: 14px;
        font-weight: 500;
        color: #4b5563;
        box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      }

      .btn-nav {
        position: relative;
        overflow: hidden;
      }

      .btn-nav::after {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        border-radius: 50%;
        background: rgba(255,255,255,0.3);
        transform: translate(-50%, -50%);
        transition: width 0.4s, height 0.4s;
      }

      .btn-nav:hover::after {
        width: 300px;
        height: 300px;
      }

      .input-field {
        transition: all 0.3s ease;
        border: 2px solid #e5e7eb;
      }

      .input-field:focus {
        border-color: #667eea;
        box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
        transform: translateY(-2px);
      }

      .form-card {
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .form-card:hover {
        box-shadow: 0 12px 32px rgba(0,0,0,0.12);
        transform: translateY(-4px);
      }

      @keyframes float {
        0%, 100% { transform: translateY(0px); }
        50% { transform: translateY(-10px); }
      }

      .float-animation {
        animation: float 3s ease-in-out infinite;
      }

      .gradient-text {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }
    </style>
    <style>@view-transition { navigation: auto; }</style>
  </head>
  <body class="h-full">
    <div id="app" class="h-full flex flex-col" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
      <!-- Navigation -->
      <nav class="glass-effect shadow-2xl flex-shrink-0 border-b border-purple-100">
        <div class="max-w-7xl mx-auto px-2 sm:px-4 lg:px-8">
          <div class="flex flex-col sm:flex-row justify-between items-center py-3 sm:py-0 sm:h-20 gap-3 sm:gap-0">
            <div class="flex items-center w-full sm:w-auto justify-center sm:justify-start">
              <div class="flex-shrink-0 flex items-center float-animation">
                <div class="text-2xl sm:text-3xl">üìã</div>
                <h1 id="nav-title" class="ml-2 sm:ml-3 text-lg sm:text-2xl font-bold gradient-text">
                  ‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô
                </h1>
              </div>
            </div>
            <div class="flex items-center flex-wrap justify-center gap-2 sm:space-x-3 w-full sm:w-auto">
              <button id="btn-dashboard" class="btn-nav px-3 sm:px-5 py-2 sm:py-2.5 rounded-lg sm:rounded-xl text-sm sm:text-base font-medium shadow-lg hover:shadow-2xl relative z-10" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; font-weight: 600;">
                <span class="hidden sm:inline">üìä Dashboard</span>
                <span class="sm:hidden">üìä</span>
              </button>
              <button id="btn-timeline" class="btn-nav px-3 sm:px-5 py-2 sm:py-2.5 rounded-lg sm:rounded-xl text-sm sm:text-base font-medium shadow-lg hover:shadow-2xl relative z-10" style="background: linear-gradient(135deg, #8b5cf6 0%, #c026d3 100%); color: white; font-weight: 600;">
                <span class="hidden sm:inline">üïê ‡πÑ‡∏ó‡∏°‡πå‡πÑ‡∏•‡∏ô‡πå</span>
                <span class="sm:hidden">üïê</span>
              </button>
              <button id="btn-import" class="btn-nav px-3 sm:px-5 py-2 sm:py-2.5 rounded-lg sm:rounded-xl text-sm sm:text-base font-medium shadow-lg hover:shadow-2xl relative z-10" style="background: linear-gradient(135deg, #ec4899 0%, #f43f5e 100%); color: white; font-weight: 600;">
                <span class="hidden sm:inline">üì• ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤</span>
                <span class="sm:hidden">üì•</span>
              </button>
              <button id="btn-add-task" class="btn-nav px-3 sm:px-5 py-2 sm:py-2.5 rounded-lg sm:rounded-xl text-sm sm:text-base font-medium shadow-lg hover:shadow-2xl relative z-10" style="background: linear-gradient(135deg, #10b981 0%, #14b8a6 100%); color: white; font-weight: 600;">
                <span class="hidden sm:inline">‚ûï ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</span>
                <span class="sm:hidden">‚ûï</span>
              </button>
              <button id="btn-evaluation" class="btn-nav px-3 sm:px-5 py-2 sm:py-2.5 rounded-lg sm:rounded-xl text-sm sm:text-base font-medium shadow-lg hover:shadow-2xl relative z-10" style="background: linear-gradient(135deg, #f59e0b 0%, #f97316 100%); color: white; font-weight: 600;">
                <span class="hidden sm:inline">‚≠ê ‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô</span>
                <span class="sm:hidden">‚≠ê</span>
              </button>
            </div>
          </div>
        </div>
      </nav>

      <div class="flex-1 overflow-y-auto">
        <!-- Dashboard View -->
        <div id="dashboard-view" class="max-w-7xl mx-auto px-3 sm:px-4 lg:px-8 py-4 sm:py-8">
          <div class="bg-white rounded-xl sm:rounded-2xl shadow-xl p-4 sm:p-8 mb-4 sm:mb-8">
            <h2 id="company-name-display" class="text-xl sm:text-3xl font-bold mb-4 sm:mb-6" style="color: #1f2937;">
              ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó / ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô
            </h2>

            <!-- Stats Cards -->
            <div class="grid grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-6 mb-6 sm:mb-8">
              <div class="stat-card bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl p-6 text-white shadow-lg">
                <div class="text-4xl mb-2">üìù</div>
                <div class="text-2xl font-bold" id="total-tasks">0</div>
                <div class="text-sm opacity-90">‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
              </div>
              <div class="stat-card bg-gradient-to-br from-green-500 to-green-600 rounded-xl p-6 text-white shadow-lg">
                <div class="text-4xl mb-2">‚úÖ</div>
                <div class="text-2xl font-bold" id="completed-tasks">0</div>
                <div class="text-sm opacity-90">‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</div>
              </div>
              <div class="stat-card bg-gradient-to-br from-yellow-500 to-yellow-600 rounded-xl p-6 text-white shadow-lg">
                <div class="text-4xl mb-2">‚è≥</div>
                <div class="text-2xl font-bold" id="pending-tasks">0</div>
                <div class="text-sm opacity-90">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</div>
              </div>
              <div class="stat-card bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl p-6 text-white shadow-lg">
                <div class="text-4xl mb-2">‚≠ê</div>
                <div class="text-2xl font-bold" id="avg-rating">0.0</div>
                <div class="text-sm opacity-90">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢</div>
              </div>
            </div>

            <!-- Task List -->
            <div class="bg-gray-50 rounded-xl p-6">
              <h3 class="text-xl font-bold mb-4" style="color: #1f2937;">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h3>
              <div id="task-list" class="space-y-3">
                <div class="text-center py-8 text-gray-500">
                  ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏á‡∏≤‡∏ô" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Timeline View -->
        <div id="timeline-view" class="max-w-5xl mx-auto px-3 sm:px-4 lg:px-8 py-4 sm:py-8 hidden">
          <div class="bg-white rounded-xl sm:rounded-2xl shadow-xl p-4 sm:p-8">
            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 sm:mb-6 gap-3 sm:gap-0">
              <h2 class="text-xl sm:text-3xl font-bold" style="color: #1f2937;">üïê ‡πÑ‡∏ó‡∏°‡πå‡πÑ‡∏•‡∏ô‡πå‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</h2>
              <div class="flex gap-2">
                <input type="date" id="timeline-filter-date" class="px-4 py-2 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-purple-500">
                <button id="btn-clear-filter" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-medium hover:bg-gray-300 transition-colors">
                  ‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á
                </button>
              </div>
            </div>
            <div id="timeline-container" class="mt-8">
              <div class="text-center py-12 text-gray-500">
                ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡πÑ‡∏ó‡∏°‡πå‡πÑ‡∏•‡∏ô‡πå ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏á‡∏≤‡∏ô" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô
              </div>
            </div>
          </div>
        </div>

        <!-- Import Data View -->
        <div id="import-view" class="max-w-4xl mx-auto px-3 sm:px-4 lg:px-8 py-4 sm:py-8 hidden">
          <div class="bg-white rounded-xl sm:rounded-2xl shadow-xl p-4 sm:p-8">
            <h2 class="text-xl sm:text-3xl font-bold mb-4 sm:mb-6" style="color: #1f2937;">üì• ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</h2>

            <div class="bg-blue-50 border-2 border-blue-300 rounded-xl p-6 mb-8">
              <div class="flex items-start gap-3">
                <div class="text-3xl">üí°</div>
                <div>
                  <h3 class="font-bold text-blue-900 mb-2">‡∏ß‡∏¥‡∏ò‡∏µ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Google Calendar</h3>
                  <ol class="text-sm text-blue-800 space-y-1 list-decimal list-inside">
                    <li>‡πÄ‡∏õ‡∏¥‡∏î Google Calendar ‡∏ö‡∏ô‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå</li>
                    <li>‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤</li>
                    <li>‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ‡πÄ‡∏ß‡∏•‡∏≤ ‡πÅ‡∏•‡∏∞‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà</li>
                    <li>‡∏ß‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á</li>
                    <li>‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</li>
                  </ol>
                </div>
              </div>
            </div>

            <form id="import-form" class="space-y-6">
              <!-- ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ -->
              <div class="bg-gradient-to-r from-pink-50 to-purple-50 rounded-xl p-6 mb-6">
                <label class="block text-sm font-medium mb-3" style="color: #374151;">
                  üìã ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤
                </label>
                <div class="flex gap-4">
                  <input type="number" id="import-count" min="1" max="10" value="1" class="w-32 px-4 py-3 border-2 border-purple-300 rounded-lg focus:outline-none focus:border-purple-500 transition-colors text-center text-xl font-bold">
                  <button type="button" id="generate-forms-btn" class="px-6 py-3 rounded-lg font-medium text-white transition-colors" style="background-color: #ec4899;">
                    ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°
                  </button>
                </div>
                <p class="text-sm text-gray-600 mt-2">*‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 10 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô</p>
              </div>

              <!-- ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤ -->
              <div id="import-forms-container" class="space-y-6"></div>

              <div class="flex gap-4 pt-4">
                <button type="submit" id="submit-import-btn" class="flex-1 px-6 py-4 rounded-lg font-medium text-white text-lg transition-colors" style="background-color: #ec4899;">
                  üì• ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                </button>
                <button type="button" id="cancel-import-btn" class="px-6 py-4 rounded-lg font-medium transition-colors text-lg" style="background-color: #e5e7eb; color: #374151;">
                  ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                </button>
              </div>
            </form>
          </div>
        </div>

        <!-- Add Task View -->
        <div id="add-task-view" class="max-w-3xl mx-auto px-3 sm:px-4 lg:px-8 py-4 sm:py-8 hidden">
          <div class="bg-white rounded-xl sm:rounded-2xl shadow-xl p-4 sm:p-8">
            <h2 class="text-xl sm:text-3xl font-bold mb-4 sm:mb-6" style="color: #1f2937;">üìù ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô</h2>
            <form id="task-form" class="space-y-6">
              <div>
                <label for="task-date" class="block text-sm font-semibold mb-2 text-gray-700">üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà *</label>
                <input type="date" id="task-date" required class="input-field w-full px-4 py-3 rounded-xl focus:outline-none">
              </div>

              <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                  <label for="start-time" class="block text-sm font-semibold mb-2 text-gray-700">üïê ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏° *</label>
                  <input type="time" id="start-time" required class="input-field w-full px-4 py-3 rounded-xl focus:outline-none">
                </div>
                <div>
                  <label for="end-time" class="block text-sm font-semibold mb-2 text-gray-700">üïê ‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î *</label>
                  <input type="time" id="end-time" required class="input-field w-full px-4 py-3 rounded-xl focus:outline-none">
                </div>
              </div>

              <div>
                <label for="task-description" class="block text-sm font-semibold mb-2 text-gray-700">üìù ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏á‡∏≤‡∏ô *</label>
                <textarea id="task-description" required rows="5" placeholder="‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥..." class="input-field w-full px-4 py-3 rounded-xl focus:outline-none"></textarea>
              </div>

              <div>
                <label for="task-location" class="block text-sm font-semibold mb-2 text-gray-700">üìç ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà</label>
                <input type="text" id="task-location" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)" class="input-field w-full px-4 py-3 rounded-xl focus:outline-none">
              </div>

              <div>
                <label for="task-status" class="block text-sm font-semibold mb-2 text-gray-700">üéØ ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ *</label>
                <select id="task-status" required class="input-field w-full px-4 py-3 rounded-xl focus:outline-none">
                  <option value="pending">‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</option>
                  <option value="completed">‚úÖ ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</option>
                </select>
              </div>

              <div class="flex gap-4 pt-2">
                <button type="submit" id="submit-task-btn" class="btn-nav flex-1 px-8 py-4 rounded-xl font-semibold text-white text-lg shadow-xl hover:shadow-2xl relative z-10" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                  üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                </button>
                <button type="button" id="cancel-task-btn" class="px-8 py-4 rounded-xl font-semibold text-lg shadow-lg hover:shadow-xl" style="background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%); color: #374151;">
                  ‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                </button>
              </div>
            </form>
          </div>
        </div>

        <!-- Evaluation View -->
        <div id="evaluation-view" class="max-w-4xl mx-auto px-3 sm:px-4 lg:px-8 py-4 sm:py-8 hidden">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 sm:gap-8">
            <!-- QR Code Section -->
            <div class="bg-white rounded-2xl shadow-xl p-8">
              <h2 class="text-2xl font-bold mb-4" style="color: #1f2937;">üì± QR Code ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</h2>
              <p class="text-gray-600 mb-6">‡πÉ‡∏´‡πâ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏™‡πÅ‡∏Å‡∏ô QR Code ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</p>
              <div id="qrcode" class="flex justify-center mb-4 bg-gray-50 p-6 rounded-xl"></div>
              <p class="text-sm text-center text-gray-500">‡∏™‡πÅ‡∏Å‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô</p>
            </div>

            <!-- Evaluation Form Section -->
            <div class="bg-white rounded-2xl shadow-xl p-8">
              <h2 id="evaluation-form-title" class="text-2xl font-bold mb-6" style="color: #1f2937;">
                ‚≠ê ‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏∂‡∏á‡∏û‡∏≠‡πÉ‡∏à
              </h2>
              <form id="evaluation-form" class="space-y-6">
                <div>
                  <label for="customer-name" class="block text-sm font-medium mb-2" style="color: #374151;">
                    ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
                  </label>
                  <input type="text" id="customer-name" placeholder="‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö" class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-purple-500 transition-colors">
                </div>

                <div>
                  <label class="block text-sm font-medium mb-3" style="color: #374151;">
                    ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏∂‡∏á‡∏û‡∏≠‡πÉ‡∏à *
                  </label>
                  <div id="star-rating" class="flex justify-center gap-2 text-4xl mb-2">
                    <span class="star" data-rating="1">‚≠ê</span>
                    <span class="star" data-rating="2">‚≠ê</span>
                    <span class="star" data-rating="3">‚≠ê</span>
                    <span class="star" data-rating="4">‚≠ê</span>
                    <span class="star" data-rating="5">‚≠ê</span>
                  </div>
                  <p id="rating-text" class="text-center text-sm text-gray-500">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</p>
                </div>

                <div>
                  <label for="customer-comment" class="block text-sm font-medium mb-2" style="color: #374151;">
                    ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°
                  </label>
                  <textarea id="customer-comment" rows="4" placeholder="‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô..." class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-purple-500 transition-colors"></textarea>
                </div>

                <button type="submit" id="submit-evaluation-btn" class="w-full px-6 py-4 rounded-lg font-bold text-white transition-all text-lg" style="background-color: #f59e0b;">
                  ‡∏™‡πà‡∏á‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô
                </button>
              </form>

              <div id="evaluation-success" class="hidden mt-6 p-4 bg-green-100 border-2 border-green-500 rounded-lg text-center">
                <div class="text-4xl mb-2">‚úÖ</div>
                <p class="text-green-800 font-medium">‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô!</p>
              </div>
            </div>
          </div>
        </div>
      </div> <!-- /flex-1 -->
    </div> <!-- /app -->

    <script>
      const defaultConfig = {
        system_title: '‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô',
        company_name: '‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó / ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô',
        evaluation_title: '‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏∂‡∏á‡∏û‡∏≠‡πÉ‡∏à',
        primary_color: '#667eea',
        button_color: '#10b981',
        accent_color: '#f59e0b'
      };

      let currentRecordCount = 0;
      let currentView = 'dashboard';
      let selectedRating = 0;
      let allRecords = [];
      let filteredDate = null;

      function hasGAS() {
        return typeof google !== 'undefined' && google.script && google.script.run;
      }

      function addRecordClient(record) {
        return new Promise((resolve, reject) => {
          if (hasGAS()) {
            google.script.run
              .withSuccessHandler(resolve)
              .withFailureHandler(reject)
              .addRecord(record);
          } else {
            reject(new Error('google.script.run not available'));
          }
        });
      }

      function fetchRecords() {
        if (!hasGAS()) return;
        google.script.run
          .withSuccessHandler((data) => {
            allRecords = data || [];
            currentRecordCount = allRecords.length;
            updateDashboard(allRecords);
            updateTimeline(allRecords);
          })
          .listRecords();
      }

      function initApp() {
        setupEventListeners();
        setTodayDate();
        generateQRCode();
        fetchRecords();

        // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
        document.getElementById('nav-title').textContent = defaultConfig.system_title;
        document.getElementById('company-name-display').textContent = defaultConfig.company_name;
        document.getElementById('evaluation-form-title').textContent = defaultConfig.evaluation_title;

        if (window.location.hash === '#evaluation-form') {
          setTimeout(() => switchView('evaluation'), 100);
        }
      }

      function setupEventListeners() {
        document.getElementById('btn-dashboard').addEventListener('click', () => switchView('dashboard'));
        document.getElementById('btn-timeline').addEventListener('click', () => switchView('timeline'));
        document.getElementById('btn-import').addEventListener('click', () => {
          switchView('import');
          generateImportForms(1);
        });
        document.getElementById('btn-add-task').addEventListener('click', () => switchView('add-task'));
        document.getElementById('btn-evaluation').addEventListener('click', () => switchView('evaluation'));

        document.getElementById('generate-forms-btn').addEventListener('click', () => {
          const count = parseInt(document.getElementById('import-count').value) || 1;
          generateImportForms(count);
        });

        document.getElementById('import-form').addEventListener('submit', handleImportSubmit);
        document.getElementById('cancel-import-btn').addEventListener('click', () => switchView('dashboard'));

        document.getElementById('task-form').addEventListener('submit', handleTaskSubmit);
        document.getElementById('cancel-task-btn').addEventListener('click', () => switchView('dashboard'));

        document.getElementById('evaluation-form').addEventListener('submit', handleEvaluationSubmit);

        document.getElementById('timeline-filter-date').addEventListener('change', (e) => {
          filteredDate = e.target.value;
          updateTimeline(allRecords);
        });

        document.getElementById('btn-clear-filter').addEventListener('click', () => {
          filteredDate = null;
          document.getElementById('timeline-filter-date').value = '';
          updateTimeline(allRecords);
        });

        const stars = document.querySelectorAll('.star');
        stars.forEach(star => {
          star.addEventListener('click', () => {
            selectedRating = parseInt(star.dataset.rating);
            updateStarDisplay();
          });
        });
      }

      function switchView(view) {
        currentView = view;

        document.getElementById('dashboard-view').classList.add('hidden');
        document.getElementById('timeline-view').classList.add('hidden');
        document.getElementById('import-view').classList.add('hidden');
        document.getElementById('add-task-view').classList.add('hidden');
        document.getElementById('evaluation-view').classList.add('hidden');

        if (view === 'dashboard') {
          document.getElementById('dashboard-view').classList.remove('hidden');
        } else if (view === 'timeline') {
          document.getElementById('timeline-view').classList.remove('hidden');
        } else if (view === 'import') {
          document.getElementById('import-view').classList.remove('hidden');
        } else if (view === 'add-task') {
          document.getElementById('add-task-view').classList.remove('hidden');
        } else if (view === 'evaluation') {
          document.getElementById('evaluation-view').classList.remove('hidden');
        }
      }

      function generateImportForms(count) {
        const container = document.getElementById('import-forms-container');
        container.innerHTML = '';

        for (let i = 1; i <= count; i++) {
          const formHTML = `
            <div class="border-2 border-pink-200 rounded-xl p-6 bg-gradient-to-br from-white to-pink-50">
              <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-pink-700">üìù ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà ${i}</h3>
                <span class="px-3 py-1 bg-pink-500 text-white rounded-full text-sm font-medium">Item ${i}</span>
              </div>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-medium mb-2" style="color: #374151;">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà *</label>
                  <input type="date" id="import-date-${i}" required class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-pink-500 transition-colors">
                </div>
                <div>
                  <label class="block text-sm font-medium mb-2" style="color: #374151;">‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏° *</label>
                  <input type="time" id="import-start-${i}" required class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-pink-500 transition-colors">
                </div>
                <div>
                  <label class="block text-sm font-medium mb-2" style="color: #374151;">‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î *</label>
                  <input type="time" id="import-end-${i}" required class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-pink-500 transition-colors">
                </div>
                <div class="md:col-span-2">
                  <label class="block text-sm font-medium mb-2" style="color: #374151;">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏á‡∏≤‡∏ô *</label>
                  <textarea id="import-description-${i}" required rows="3" placeholder="‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏à‡∏≤‡∏Å Google Calendar..." class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-pink-500 transition-colors"></textarea>
                </div>
                <div>
                  <label class="block text-sm font-medium mb-2" style="color: #374151;">‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà</label>
                  <input type="text" id="import-location-${i}" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà" class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-pink-500 transition-colors">
                </div>
                <div>
                  <label class="block text-sm font-medium mb-2" style="color: #374151;">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ *</label>
                  <select id="import-status-${i}" required class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-pink-500 transition-colors">
                    <option value="completed">‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</option>
                    <option value="pending">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</option>
                  </select>
                </div>
              </div>
            </div>
          `;
          container.insertAdjacentHTML('beforeend', formHTML);
        }

        const today = new Date().toISOString().split('T')[0];
        for (let i = 1; i <= count; i++) {
          const el = document.getElementById(`import-date-${i}`);
          if (el) el.value = today;
        }
      }

      function setTodayDate() {
        const today = new Date().toISOString().split('T')[0];
        const dateEl = document.getElementById('task-date');
        if (dateEl) dateEl.value = today;

        const now = new Date();
        const hours = String(now.getHours()).padStart(2, '0');
        const minutes = String(now.getMinutes()).padStart(2, '0');
        const startEl = document.getElementById('start-time');
        if (startEl) startEl.value = `${hours}:${minutes}`;
      }

      async function handleImportSubmit(e) {
        e.preventDefault();

        const count = parseInt(document.getElementById('import-count').value) || 1;

        if (currentRecordCount + count > 999) {
          const errorDiv = document.createElement('div');
          errorDiv.className = 'mt-4 p-4 bg-red-100 border-2 border-red-500 rounded-lg text-center';
          errorDiv.innerHTML = `<p class="text-red-800 font-medium">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏î‡πâ ‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡∏à‡∏∞‡πÄ‡∏Å‡∏¥‡∏ô‡∏Ç‡∏µ‡∏î‡∏à‡∏≥‡∏Å‡∏±‡∏î 999 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ (‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏°‡∏µ ${currentRecordCount} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)</p>`;
          document.getElementById('import-form').appendChild(errorDiv);
          setTimeout(() => errorDiv.remove(), 4000);
          return;
        }

        const submitBtn = document.getElementById('submit-import-btn');
        submitBtn.disabled = true;
        submitBtn.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤...';

        let successCount = 0;
        let errorCount = 0;

        for (let i = 1; i <= count; i++) {
          const taskData = {
            id: `${Date.now()}-${i}`,
            type: 'task',
            date: document.getElementById(`import-date-${i}`).value,
            startTime: document.getElementById(`import-start-${i}`).value,
            endTime: document.getElementById(`import-end-${i}`).value,
            employeeName: '',
            taskDescription: document.getElementById(`import-description-${i}`).value,
            location: document.getElementById(`import-location-${i}`).value || '',
            status: document.getElementById(`import-status-${i}`).value,
            rating: 0,
            comment: '',
            timestamp: Date.now() + i
          };

          try {
            const result = await addRecordClient(taskData);
            if (result && result.success) successCount++;
            else errorCount++;
          } catch (err) {
            errorCount++;
          }
        }

        fetchRecords();

        if (successCount > 0) {
          const successDiv = document.createElement('div');
          successDiv.className = 'mt-4 p-4 bg-green-100 border-2 border-green-500 rounded-lg text-center';
          successDiv.innerHTML = `<p class="text-green-800 font-medium">‚úÖ ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ${successCount} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£!</p>`;
          document.getElementById('import-form').appendChild(successDiv);

          setTimeout(() => {
            successDiv.remove();
            switchView('timeline');
          }, 2000);
        }

        if (errorCount > 0) {
          const errorDiv = document.createElement('div');
          errorDiv.className = 'mt-4 p-4 bg-yellow-100 border-2 border-yellow-500 rounded-lg text-center';
          errorDiv.innerHTML = `<p class="text-yellow-800 font-medium">‚ö†Ô∏è ‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ${errorCount} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>`;
          document.getElementById('import-form').appendChild(errorDiv);
          setTimeout(() => errorDiv.remove(), 3000);
        }

        submitBtn.disabled = false;
        submitBtn.textContent = 'üì• ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î';
      }

      async function handleTaskSubmit(e) {
        e.preventDefault();

        if (currentRecordCount >= 999) {
          const errorDiv = document.createElement('div');
          errorDiv.className = 'mt-4 p-4 bg-red-100 border-2 border-red-500 rounded-lg text-center';
          errorDiv.innerHTML = '<p class="text-red-800 font-medium">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏î‡πâ ‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡∏ñ‡∏∂‡∏á‡∏Ç‡∏µ‡∏î‡∏à‡∏≥‡∏Å‡∏±‡∏î 999 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤‡∏Å‡πà‡∏≠‡∏ô</p>';
          document.getElementById('task-form').appendChild(errorDiv);
          setTimeout(() => errorDiv.remove(), 3000);
          return;
        }

        const submitBtn = document.getElementById('submit-task-btn');
        submitBtn.disabled = true;
        submitBtn.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...';

        const taskData = {
          id: Date.now().toString(),
          type: 'task',
          date: document.getElementById('task-date').value,
          startTime: document.getElementById('start-time').value,
          endTime: document.getElementById('end-time').value,
          employeeName: '',
          taskDescription: document.getElementById('task-description').value,
          location: document.getElementById('task-location').value,
          status: document.getElementById('task-status').value,
          rating: 0,
          comment: '',
          timestamp: Date.now()
        };

        try {
          const result = await addRecordClient(taskData);
          if (result && result.success) {
            document.getElementById('task-form').reset();
            setTodayDate();

            const successDiv = document.createElement('div');
            successDiv.className = 'mt-4 p-4 bg-green-100 border-2 border-green-500 rounded-lg text-center';
            successDiv.innerHTML = '<p class="text-green-800 font-medium">‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</p>';
            document.getElementById('task-form').appendChild(successDiv);

            fetchRecords();

            setTimeout(() => {
              successDiv.remove();
              switchView('timeline');
            }, 1500);
          } else {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'mt-4 p-4 bg-red-100 border-2 border-red-500 rounded-lg text-center';
            errorDiv.innerHTML = '<p class="text-red-800 font-medium">‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</p>';
            document.getElementById('task-form').appendChild(errorDiv);
            setTimeout(() => errorDiv.remove(), 3000);
          }
        } catch (err) {
          const errorDiv = document.createElement('div');
          errorDiv.className = 'mt-4 p-4 bg-red-100 border-2 border-red-500 rounded-lg text-center';
          errorDiv.innerHTML = '<p class="text-red-800 font-medium">‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</p>';
          document.getElementById('task-form').appendChild(errorDiv);
          setTimeout(() => errorDiv.remove(), 3000);
        }

        submitBtn.disabled = false;
        submitBtn.textContent = 'üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';
      }

      async function handleEvaluationSubmit(e) {
        e.preventDefault();

        if (selectedRating === 0) {
          showEvaluationError('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô');
          return;
        }

        if (currentRecordCount >= 999) {
          showEvaluationError('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏î‡πâ ‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡∏ñ‡∏∂‡∏á‡∏Ç‡∏µ‡∏î‡∏à‡∏≥‡∏Å‡∏±‡∏î 999 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß');
          return;
        }

        const submitBtn = document.getElementById('submit-evaluation-btn');
        const originalText = submitBtn.textContent;
        submitBtn.disabled = true;
        submitBtn.textContent = '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á...';
        submitBtn.style.opacity = '0.6';

        try {
          const now = new Date();
          const currentTime = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;

          const evaluationData = {
            id: `eval-${Date.now()}`,
            type: 'evaluation',
            date: new Date().toISOString().split('T')[0],
            startTime: currentTime,
            endTime: currentTime,
            employeeName: document.getElementById('customer-name').value || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠',
            taskDescription: '‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏à‡∏≤‡∏Å‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤',
            location: '',
            status: 'completed',
            rating: selectedRating,
            comment: document.getElementById('customer-comment').value || '',
            timestamp: Date.now()
          };

          const result = await addRecordClient(evaluationData);

          if (result && result.success) {
            fetchRecords();

            document.getElementById('evaluation-form').classList.add('hidden');
            document.getElementById('evaluation-success').classList.remove('hidden');

            setTimeout(() => {
              document.getElementById('evaluation-form').reset();
              document.getElementById('evaluation-form').classList.remove('hidden');
              document.getElementById('evaluation-success').classList.add('hidden');
              selectedRating = 0;
              updateStarDisplay();
              submitBtn.disabled = false;
              submitBtn.textContent = originalText;
              submitBtn.style.opacity = '1';
            }, 3000);
          } else {
            showEvaluationError('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á');
            submitBtn.disabled = false;
            submitBtn.textContent = originalText;
            submitBtn.style.opacity = '1';
          }
        } catch (error) {
          showEvaluationError(`‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${error.message || '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á'}`);
          submitBtn.disabled = false;
          submitBtn.textContent = originalText;
          submitBtn.style.opacity = '1';
        }
      }

      function showEvaluationError(message) {
        const errorDiv = document.createElement('div');
        errorDiv.className = 'mt-4 p-4 bg-red-100 border-2 border-red-500 rounded-lg text-center evaluation-error';
        errorDiv.innerHTML = `<p class="text-red-800 font-medium">‚ùå ${message}</p>`;

        const form = document.getElementById('evaluation-form');
        const existingError = form.querySelector('.evaluation-error');
        if (existingError) existingError.remove();

        form.appendChild(errorDiv);
        setTimeout(() => errorDiv.remove(), 3000);
      }

      function updateStarDisplay() {
        const stars = document.querySelectorAll('.star');
        const ratingText = document.getElementById('rating-text');

        stars.forEach((star, index) => {
          if (index < selectedRating) {
            star.classList.add('active');
          } else {
            star.classList.remove('active');
          }
        });

        const ratingLabels = ['', '‡πÅ‡∏¢‡πà‡∏°‡∏≤‡∏Å', '‡πÅ‡∏¢‡πà', '‡∏û‡∏≠‡πÉ‡∏ä‡πâ', '‡∏î‡∏µ', '‡∏î‡∏µ‡∏°‡∏≤‡∏Å'];
        ratingText.textContent = selectedRating > 0 ? ratingLabels[selectedRating] : '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô';
      }

      function updateDashboard(data) {
        const tasks = data.filter(item => item.type === 'task');
        const evaluations = data.filter(item => item.type === 'evaluation');

        const completedTasks = tasks.filter(task => task.status === 'completed').length;
        const pendingTasks = tasks.filter(task => task.status === 'pending').length;

        const ratings = evaluations.map(e => e.rating).filter(r => r > 0);
        const avgRating = ratings.length > 0 ? (ratings.reduce((a, b) => a + b, 0) / ratings.length).toFixed(1) : '0.0';

        document.getElementById('total-tasks').textContent = tasks.length;
        document.getElementById('completed-tasks').textContent = completedTasks;
        document.getElementById('pending-tasks').textContent = pendingTasks;
        document.getElementById('avg-rating').textContent = avgRating;

        const taskList = document.getElementById('task-list');

        if (data.length === 0) {
          taskList.innerHTML = '<div class="text-center py-8 text-gray-500">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏á‡∏≤‡∏ô" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</div>';
          return;
        }

        const sortedData = [...data].sort((a, b) => b.timestamp - a.timestamp).slice(0, 10);

        taskList.innerHTML = sortedData.map(item => {
          const statusColor = item.status === 'completed' ? '#10b981' : '#f59e0b';
          const statusText = item.status === 'completed' ? '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô' : '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£';
          const typeIcon = item.type === 'task' ? 'üìù' : '‚≠ê';
          const ratingDisplay = item.rating > 0 ? `‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: ${'‚≠ê'.repeat(item.rating)}` : '';
          const timeDisplay = item.startTime ? `${item.startTime} - ${item.endTime}` : '';
          const locationDisplay = item.location ? `üìç ${item.location}` : '';

          return `
            <div class="task-item bg-white p-4 rounded-lg border-2 border-gray-200">
              <div class="flex justify-between items-start">
                <div class="flex-1">
                  <div class="flex items-center gap-2 mb-2">
                    <span class="text-2xl">${typeIcon}</span>
                    <span class="text-sm text-gray-500">${item.date}</span>
                    ${timeDisplay ? `<span class="text-sm text-blue-600">üïê ${timeDisplay}</span>` : ''}
                  </div>
                  <p class="text-gray-600 mb-2">${item.taskDescription}</p>
                  ${locationDisplay ? `<p class="text-sm text-gray-500 mb-2">${locationDisplay}</p>` : ''}
                  ${ratingDisplay ? `<p class="text-sm text-yellow-600">${ratingDisplay}</p>` : ''}
                  ${item.comment ? `<p class="text-sm text-gray-500 italic">"${item.comment}"</p>` : ''}
                </div>
                <span class="px-3 py-1 rounded-full text-sm font-medium text-white" style="background-color: ${statusColor};">
                  ${statusText}
                </span>
              </div>
            </div>
          `;
        }).join('');
      }

      function updateTimeline(data) {
        const timelineContainer = document.getElementById('timeline-container');

        let filteredData = data.filter(item => item.type === 'task');

        if (filteredDate) {
          filteredData = filteredData.filter(item => item.date === filteredDate);
        }

        if (filteredData.length === 0) {
          const message = filteredDate
            ? `‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ${new Date(filteredDate).toLocaleDateString('th-TH', { year: 'numeric', month: 'long', day: 'numeric' })}`
            : '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡πÑ‡∏ó‡∏°‡πå‡πÑ‡∏•‡∏ô‡πå ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏á‡∏≤‡∏ô" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô';
          timelineContainer.innerHTML = `<div class="text-center py-12 text-gray-500">${message}</div>`;
          return;
        }

        const sortedData = [...filteredData].sort((a, b) => {
          const dateCompare = b.date.localeCompare(a.date);
          if (dateCompare !== 0) return dateCompare;
          return (b.startTime || '').localeCompare(a.startTime || '');
        });

        let currentDate = '';
        let timelineHTML = '';

        sortedData.forEach(item => {
          if (item.date !== currentDate) {
            currentDate = item.date;
            const dateObj = new Date(item.date + 'T00:00:00');
            const thaiDate = dateObj.toLocaleDateString('th-TH', {
              year: 'numeric',
              month: 'long',
              day: 'numeric',
              weekday: 'long'
            });

            timelineHTML += `
              <div class="mb-6 pb-4 border-b-2 border-purple-200">
                <h3 class="text-xl font-bold text-purple-700">üìÖ ${thaiDate}</h3>
              </div>
            `;
          }

          const statusColor = item.status === 'completed' ? '#10b981' : '#f59e0b';
          const statusText = item.status === 'completed' ? '‚úÖ ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô' : '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£';
          const duration = calculateDuration(item.startTime, item.endTime);

          timelineHTML += `
            <div class="timeline-item">
              <div class="timeline-dot"></div>
              <div class="timeline-content">
                <div class="flex justify-between items-start mb-3">
                  <div class="flex items-center gap-2">
                    <span class="time-badge">üïê ${item.startTime} - ${item.endTime}</span>
                    ${duration ? `<span class="time-badge">‚è±Ô∏è ${duration}</span>` : ''}
                  </div>
                  <span class="px-3 py-1 rounded-full text-sm font-medium text-white" style="background-color: ${statusColor};">
                    ${statusText}
                  </span>
                </div>
                <p class="text-gray-700 mb-2">${item.taskDescription}</p>
                ${item.location ? `<p class="text-sm text-gray-600">üìç ${item.location}</p>` : ''}
              </div>
            </div>
          `;
        });

        timelineContainer.innerHTML = timelineHTML;
      }

      function calculateDuration(startTime, endTime) {
        if (!startTime || !endTime) return '';

        const [startHour, startMin] = startTime.split(':').map(Number);
        const [endHour, endMin] = endTime.split(':').map(Number);

        let totalMinutes = (endHour * 60 + endMin) - (startHour * 60 + startMin);
        if (totalMinutes < 0) totalMinutes += 24 * 60;

        const hours = Math.floor(totalMinutes / 60);
        const minutes = totalMinutes % 60;

        if (hours > 0 && minutes > 0) {
          return `${hours} ‡∏ä‡∏°. ${minutes} ‡∏ô‡∏≤‡∏ó‡∏µ`;
        } else if (hours > 0) {
          return `${hours} ‡∏ä‡∏°.`;
        } else {
          return `${minutes} ‡∏ô‡∏≤‡∏ó‡∏µ`;
        }
      }

      function generateQRCode() {
        const qrcodeDiv = document.getElementById('qrcode');
        if (!qrcodeDiv) return;

        qrcodeDiv.innerHTML = '';

        const currentUrl = window.location.href.split('#')[0];
        const evaluationUrl = currentUrl + '#evaluation-form';

        if (typeof QRCode !== 'undefined') {
          new QRCode(qrcodeDiv, {
            text: evaluationUrl,
            width: 250,
            height: 250,
            colorDark: '#000000',
            colorLight: '#ffffff',
            correctLevel: QRCode.CorrectLevel.H
          });
        }
      }

      window.addEventListener('load', initApp);
    </script>
  </body>
</html>
